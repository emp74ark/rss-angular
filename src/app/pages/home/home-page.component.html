<mat-toolbar>
  <mat-toolbar-row id="view-toggle">
    <mat-button-toggle>
      <mat-icon
        [class]="display() === 'title' ? 'highlighted' : undefined"
        (click)="toggleDisplay('title')"
        >view_day
      </mat-icon>
      <mat-icon
        [class]="display() === 'short' ? 'highlighted' : undefined"
        (click)="toggleDisplay('short')"
        >view_agenda
      </mat-icon>
    </mat-button-toggle>
    <mat-button-toggle>
      <mat-icon
        [class]="readFilter() ? 'highlighted' : undefined"
        (click)="filterHandler('read')"
        [title]="readFilter() ? 'Show read' : 'Show unread'"
        >{{ readFilter() ? 'mark_email_unread' : 'mark_email_read' }}
      </mat-icon>
      <mat-icon
        [class]="favFilter() ? 'highlighted' : undefined"
        (click)="filterHandler('fav')"
        [title]="favFilter() ? 'Show favorites' : 'Show all'"
        >bookmark
      </mat-icon>
    </mat-button-toggle>
  </mat-toolbar-row>
</mat-toolbar>
@defer {
  @for (a of articles(); track a._id) {
    <mat-card class="card" appearance="outlined" (click)="onArticleClick(a)">
      <mat-card-header>
        <mat-card-title>{{ a.title }}</mat-card-title>
        <mat-card-subtitle>Published: {{ a.isoDate | date: 'short' }}</mat-card-subtitle>
      </mat-card-header>
      @if (display() !== 'title') {
        <mat-card-content>
          <p [innerHtml]="safeHtml(a.content)"></p>
        </mat-card-content>
      }
      <mat-card-actions>
        <a href="{{ a.link }}" matIconButton target="_blank" title="Open the source URL">
          <mat-icon>link</mat-icon>
        </a>
        <a
          routerLink="/subscription/{{ a.subscriptionId }}/article/{{ a._id }}"
          matIconButton
          title="Open the article"
        >
          <mat-icon>open_in_new</mat-icon>
        </a>
        <button matIconButton (click)="markAsRead(a, $event)" title="Mark as read">
          <mat-icon>{{ a.read ? 'mark_email_read' : 'mark_email_unread' }}</mat-icon>
        </button>
        <button
          matIconButton
          [class]="a.tags.includes(favTagId()) ? 'highlighted' : undefined"
          (click)="onAddToBookmarks(a, $event)"
          title="Add to bookmarks"
        >
          <mat-icon>bookmark</mat-icon>
        </button>
        <app-row-spacer />
        <mat-chip-set>
          @for (t of userTags(); track t._id) {
            <mat-chip-option [selected]="a.tags.includes(t._id)" (click)="tagHandler(a, t, $event)"
              >{{ t.name }}
            </mat-chip-option>
          }
        </mat-chip-set>
      </mat-card-actions>
    </mat-card>
  } @empty {
    <h2>No articles found</h2>
  }
} @loading (minimum 0.5s) {
  <mat-progress-bar mode="query" />
}
<mat-toolbar>
  <mat-toolbar-row id="paginator">
    @if (articles().length > 0) {
      <mat-paginator
        id="paginator"
        [length]="totalResults()"
        [pageSize]="10"
        [pageSizeOptions]="[5, 10, 20]"
        (page)="paginationHandler($event)"
      />
    }
  </mat-toolbar-row>
  <mat-toolbar-row id="actions">
    <button matButton="tonal" (click)="markManyAsRead({ articleIds: articleIds(), read: true })">
      <mat-icon>check</mat-icon>
      Skip visible
    </button>
    <button matButton="tonal" (click)="markManyAsRead({ read: true, all: true })">
      <mat-icon>done_all</mat-icon>
      Skip all
    </button>
  </mat-toolbar-row>
</mat-toolbar>
